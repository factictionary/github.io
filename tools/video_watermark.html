<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Watermark Tool | Add Text & Image Watermarks to Videos | Factictionary</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Free online video watermark tool. Add text and image watermarks to videos with customizable fonts, colors, opacity, and positioning. Privacy-protected, works entirely in your browser using FFmpeg.wasm.">
    <meta name="keywords" content="video watermark, add watermark to video, text watermark, image watermark, video protection, watermark tool, online video editor, watermark creator">
    <meta name="author" content="Factictionary Team">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Video Watermark Tool | Add Text & Image Watermarks to Videos | Factictionary">
    <meta property="og:description" content="Professional video watermark tool for adding text and image watermarks with customizable positioning, fonts, and effects. Free and privacy-protected.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://factictionary.github.io/tools/video_watermark.html">
    <meta property="og:image" content="https://factictionary.github.io/assets/images/modern_educational_platform_hero_illustration.jpg">
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Video Watermark Tool | Factictionary">
    <meta name="twitter:description" content="Add professional text and image watermarks to videos online. Free and privacy-protected.">
    <meta name="twitter:image" content="https://factictionary.github.io/assets/images/modern_educational_platform_hero_illustration.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://factictionary.github.io/tools/video_watermark.html">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/assets/css/style.css">
    
    <!-- FFmpeg.wasm Library -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/umd/ffmpeg.js"></script>
    <script src="https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd/ffmpeg-core.js"></script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Factictionary Video Watermark Tool",
        "description": "Free online video watermark tool to add text and image watermarks to videos with customizable positioning, fonts, and effects.",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "provider": {
            "@type": "Organization",
            "name": "Factictionary"
        }
    }
    </script>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main" class="skip-link">Skip to main content</a>
    
    <!-- Navigation -->
    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div class="nav-container">
            <a href="/" class="logo">Factictionary</a>
            
            <ul class="nav-links">
                <li><a href="/blog/" class="nav-link">Blog</a></li>
                <li><a href="/tools/" class="nav-link active">Tools</a></li>
                <li><a href="/about.html" class="nav-link">About</a></li>
                <li><a href="/contact.html" class="nav-link">Contact</a></li>
            </ul>
            
            <div class="nav-cta">
                <a href="/blog/" class="btn btn-primary">Read Articles</a>
            </div>
            
            <button class="menu-toggle" aria-label="Toggle mobile menu" aria-expanded="false">
                <span>‚ò∞</span>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main">
        <!-- AdSense Container -->
        <div class="ad-container top-ad">
            <!-- AdSense code will be inserted here -->
        </div>

        <!-- Tool Header -->
        <header class="tool-header">
            <div class="container">
                <div class="tool-header-content">
                    <h3 class="tool-title">Video Watermark Tool</h3>
                    <p class="tool-subtitle">Add professional text and image watermarks to your videos with customizable fonts, colors, opacity, and positioning. Perfect for content creators, businesses, and anyone needing to protect or brand their video content.</p>
                    <div class="privacy-badge">üîí 100% Privacy Protected</div>
                    <div class="tool-features">
                        <span class="feature-tag">Text Watermarks</span>
                        <span class="feature-tag">Image Watermarks</span>
                        <span class="feature-tag">Custom Positioning</span>
                        <span class="feature-tag">Real-time Preview</span>
                        <span class="feature-tag">Multiple Formats</span>
                        <span class="feature-tag">No Upload Required</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tool Workspace -->
        <section class="tool-workspace">
            <div class="container">
                <!-- Video Upload Section -->
                <div class="upload-section">
                    <label class="input-label">Video File</label>
                    <div class="file-upload-area" id="videoUploadArea">
                        <input type="file" id="videoInput" accept="video/*" hidden>
                        <div class="upload-content">
                            <div class="upload-icon">üìπ</div>
                            <div class="upload-text">
                                <h3>Drop your video here or click to browse</h3>
                                <p>Supports MP4, MOV, AVI, WebM, and more (Max 500MB)</p>
                            </div>
                            <button class="btn btn-secondary" type="button" onclick="document.getElementById('videoInput').click()">
                                Choose Video File
                            </button>
                        </div>
                    </div>
                    <div id="videoInfo" class="file-info" style="display: none;">
                        <div class="file-details">
                            <span class="file-name" id="videoFileName"></span>
                            <span class="file-size" id="videoFileSize"></span>
                        </div>
                        <button class="btn btn-secondary" onclick="clearVideo()">Remove Video</button>
                    </div>
                </div>

                <!-- Video Preview Section -->
                <div class="preview-section" id="previewSection" style="display: none;">
                    <h3 class="section-title">Video Preview</h3>
                    <div class="video-container">
                        <video id="originalVideo" controls class="video-player"></video>
                        <div class="video-overlay" id="watermarkOverlay">
                            <div class="text-watermark" id="textWatermarkDisplay"></div>
                            <img id="imageWatermarkDisplay" class="image-watermark" style="display: none;">
                        </div>
                    </div>
                </div>

                <!-- Watermark Controls -->
                <div class="controls-section" id="controlsSection" style="display: none;">
                    <h3 class="section-title">Watermark Settings</h3>
                    
                    <!-- Text Watermark Controls -->
                    <div class="control-group">
                        <h4 class="control-group-title">üìù Text Watermark</h4>
                        <div class="form-group">
                            <label for="textWatermarkInput" class="form-label">Watermark Text</label>
                            <input type="text" id="textWatermarkInput" class="form-input" placeholder="Enter your watermark text..." value="¬© Your Brand">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fontSize" class="form-label">Font Size</label>
                                <input type="range" id="fontSize" class="form-range" min="12" max="120" value="24">
                                <span class="range-value" id="fontSizeValue">24px</span>
                            </div>
                            
                            <div class="form-group">
                                <label for="fontOpacity" class="form-label">Opacity</label>
                                <input type="range" id="fontOpacity" class="form-range" min="0" max="100" value="70">
                                <span class="range-value" id="fontOpacityValue">70%</span>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="textColor" class="form-label">Text Color</label>
                                <input type="color" id="textColor" class="form-color" value="#ffffff">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Font Family</label>
                                <select id="fontFamily" class="form-select">
                                    <option value="Arial, sans-serif">Arial</option>
                                    <option value="Helvetica, sans-serif">Helvetica</option>
                                    <option value="Georgia, serif">Georgia</option>
                                    <option value="Times New Roman, serif">Times New Roman</option>
                                    <option value="Courier New, monospace">Courier New</option>
                                    <option value="Impact, sans-serif" selected>Impact</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Image Watermark Controls -->
                    <div class="control-group">
                        <h4 class="control-group-title">üñºÔ∏è Image Watermark (Optional)</h4>
                        <div class="file-upload-area" id="logoUploadArea">
                            <input type="file" id="logoInput" accept="image/*" hidden>
                            <div class="upload-content small">
                                <div class="upload-icon small">üñºÔ∏è</div>
                                <div class="upload-text small">
                                    <p>Drop logo here or click to browse</p>
                                    <small>PNG, JPG, GIF (Max 10MB)</small>
                                </div>
                                <button class="btn btn-secondary" type="button" onclick="document.getElementById('logoInput').click()">
                                    Choose Logo
                                </button>
                            </div>
                        </div>
                        <div id="logoInfo" class="file-info" style="display: none;">
                            <div class="file-details">
                                <span class="file-name" id="logoFileName"></span>
                                <span class="file-size" id="logoFileSize"></span>
                            </div>
                            <button class="btn btn-secondary" onclick="clearLogo()">Remove Logo</button>
                        </div>
                    </div>

                    <!-- Position Controls -->
                    <div class="control-group">
                        <h4 class="control-group-title">üìç Position Settings</h4>
                        <div class="position-presets">
                            <button class="position-btn" data-position="top-left">‚ÜñÔ∏è</button>
                            <button class="position-btn" data-position="top-center">‚¨ÜÔ∏è</button>
                            <button class="position-btn" data-position="top-right">‚ÜóÔ∏è</button>
                            <button class="position-btn" data-position="middle-left">‚¨ÖÔ∏è</button>
                            <button class="position-btn active" data-position="center">‚≠ï</button>
                            <button class="position-btn" data-position="middle-right">‚û°Ô∏è</button>
                            <button class="position-btn" data-position="bottom-left">‚ÜôÔ∏è</button>
                            <button class="position-btn" data-position="bottom-center">‚¨áÔ∏è</button>
                            <button class="position-btn" data-position="bottom-right">‚ÜòÔ∏è</button>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="customX" class="form-label">Custom X Position (%)</label>
                                <input type="range" id="customX" class="form-range" min="0" max="100" value="50">
                                <span class="range-value" id="customXValue">50%</span>
                            </div>
                            
                            <div class="form-group">
                                <label for="customY" class="form-label">Custom Y Position (%)</label>
                                <input type="range" id="customY" class="form-range" min="0" max="100" value="90">
                                <span class="range-value" id="customYValue">90%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Processing Controls -->
                    <div class="control-group">
                        <div class="process-actions">
                            <button class="btn btn-primary btn-large" id="processBtn" onclick="processVideo()">
                                üé¨ Apply Watermark
                            </button>
                            <button class="btn btn-secondary" id="downloadBtn" onclick="downloadVideo()" style="display: none;">
                                ‚¨áÔ∏è Download Video
                            </button>
                        </div>
                    </div>

                    <!-- Progress Indicator -->
                    <div class="progress-section" id="progressSection" style="display: none;">
                        <div class="progress-header">
                            <h4>Processing Video...</h4>
                            <span class="progress-status" id="progressStatus">Initializing...</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                        <div class="progress-details" id="progressDetails">Please wait while we process your video.</div>
                    </div>
                </div>

                <!-- Privacy Notice -->
                <div class="privacy-notice">
                    <div class="privacy-content">
                        <div class="privacy-icon">üîí</div>
                        <div class="privacy-text">
                            <h4>Privacy Protected</h4>
                            <p>Your videos are processed entirely in your browser using FFmpeg.wasm. No files are uploaded to our servers, ensuring complete privacy and security of your content.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AdSense Container -->
        <div class="ad-container bottom-ad">
            <!-- AdSense code will be inserted here -->
        </div>

        <!-- Related Tools -->
        <section class="related-tools">
            <div class="container">
                <h3 class="related-title">More Video/Audio Tools</h3>
                <div class="related-grid">
                    <a href="video_compressor.html" class="related-card">
                        <div class="related-icon">üìπ</div>
                        <div class="related-content">
                            <h4>Video Compressor</h4>
                            <p>Compress video files to reduce size while maintaining quality for easy sharing and storage</p>
                        </div>
                    </a>
                    <a href="video_converter.html" class="related-card">
                        <div class="related-icon">üîÑ</div>
                        <div class="related-content">
                            <h4>Video Converter</h4>
                            <p>Convert videos between different formats like MP4, AVI, MOV, and WebM</p>
                        </div>
                    </a>
                    <a href="audio_extractor.html" class="related-card">
                        <div class="related-icon">üéµ</div>
                        <div class="related-content">
                            <h4>Audio Extractor</h4>
                            <p>Extract audio tracks from video files and save as MP3, WAV, or other audio formats</p>
                        </div>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Content</h4>
                    <ul>
                        <li><a href="/blog/">All Articles</a></li>
                        <li><a href="/blog/?category=productivity">Productivity</a></li>
                        <li><a href="/blog/?category=technology">Technology</a></li>
                        <li><a href="/blog/?category=business">Business</a></li>
                        <li><a href="/blog/?category=learning">Learning</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Tools</h4>
                    <ul>
                        <li><a href="/tools/">All Tools</a></li>
                        <li><a href="/tools/categories/image.html">Image Tools</a></li>
                        <li><a href="/tools/categories/pdf.html">PDF Tools</a></li>
                        <li><a href="/tools/categories/video.html">Video/Audio Tools</a></li>
                        <li><a href="/tools/categories/text.html">Text Tools</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="/about.html">About</a></li>
                        <li><a href="/contact.html">Contact</a></li>
                        <li><a href="/privacy.html">Privacy Policy</a></li>
                        <li><a href="/terms.html">Terms of Service</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Connect</h4>
                    <ul>
                        <li><a href="mailto:factictionary@gmail.com">Email Us</a></li>
                        <li><a href="/contact.html">Support</a></li>
                        <li><a href="#" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">Back to Top</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Factictionary. All rights reserved. Privacy-first educational platform for the modern web.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Global variables
        let selectedVideoFile = null;
        let selectedLogoFile = null;
        let currentWatermarkPosition = 'center';
        let ffmpeg = null;
        let processedVideoBlob = null;
        let ffmpegLoaded = false;

        // DOM elements
        const videoUploadArea = document.getElementById('videoUploadArea');
        const videoInput = document.getElementById('videoInput');
        const videoInfo = document.getElementById('videoInfo');
        const originalVideo = document.getElementById('originalVideo');
        const previewSection = document.getElementById('previewSection');
        const controlsSection = document.getElementById('controlsSection');
        const textWatermarkInput = document.getElementById('textWatermarkInput');
        const fontSize = document.getElementById('fontSize');
        const fontOpacity = document.getElementById('fontOpacity');
        const textColor = document.getElementById('textColor');
        const fontFamily = document.getElementById('fontFamily');
        const logoUploadArea = document.getElementById('logoUploadArea');
        const logoInput = document.getElementById('logoInput');
        const logoInfo = document.getElementById('logoInfo');
        const processBtn = document.getElementById('processBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const progressSection = document.getElementById('progressSection');

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            // Video upload events
            videoInput.addEventListener('change', handleVideoSelect);
            setupDragDrop(videoUploadArea, handleVideoDrop);

            // Logo upload events
            logoInput.addEventListener('change', handleLogoSelect);
            setupDragDrop(logoUploadArea, handleLogoDrop);

            // Watermark control events
            textWatermarkInput.addEventListener('input', updateTextWatermark);
            fontSize.addEventListener('input', updateFontSize);
            fontOpacity.addEventListener('input', updateFontOpacity);
            textColor.addEventListener('change', updateTextWatermark);
            fontFamily.addEventListener('change', updateTextWatermark);

            // Position control events
            const positionBtns = document.querySelectorAll('.position-btn');
            positionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    positionBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentWatermarkPosition = this.dataset.position;
                    updateWatermarkPosition();
                });
            });

            // Custom position controls
            document.getElementById('customX').addEventListener('input', updateCustomPosition);
            document.getElementById('customY').addEventListener('input', updateCustomPosition);

            // Mobile menu functionality
            const menuToggle = document.querySelector('.menu-toggle');
            const navLinks = document.querySelector('.nav-links');
            
            menuToggle.addEventListener('click', () => {
                const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
                menuToggle.setAttribute('aria-expanded', !isExpanded);
                navLinks.classList.toggle('active');
            });
        }

        function setupDragDrop(element, dropHandler) {
            element.addEventListener('dragover', (e) => {
                e.preventDefault();
                element.classList.add('drag-over');
            });

            element.addEventListener('dragleave', () => {
                element.classList.remove('drag-over');
            });

            element.addEventListener('drop', (e) => {
                e.preventDefault();
                element.classList.remove('drag-over');
                dropHandler(e.dataTransfer.files[0]);
            });
        }

        function handleVideoDrop(file) {
            if (file && file.type.startsWith('video/')) {
                handleVideoSelect({ target: { files: [file] } });
            } else {
                showError('Please drop a valid video file.');
            }
        }

        function handleLogoDrop(file) {
            if (file && file.type.startsWith('image/')) {
                handleLogoSelect({ target: { files: [file] } });
            } else {
                showError('Please drop a valid image file.');
            }
        }

        function handleVideoSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Check file size (500MB limit)
            if (file.size > 500 * 1024 * 1024) {
                showError('Video file is too large. Please select a file under 500MB.');
                return;
            }

            selectedVideoFile = file;
            
            // Display file info
            document.getElementById('videoFileName').textContent = file.name;
            document.getElementById('videoFileSize').textContent = formatFileSize(file.size);
            videoInfo.style.display = 'block';
            videoUploadArea.style.display = 'none';

            // Load video for preview
            const videoURL = URL.createObjectURL(file);
            originalVideo.src = videoURL;
            previewSection.style.display = 'block';
            controlsSection.style.display = 'block';
            
            // Update text watermark
            updateTextWatermark();
        }

        function handleLogoSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Check file size (10MB limit)
            if (file.size > 10 * 1024 * 1024) {
                showError('Logo file is too large. Please select a file under 10MB.');
                return;
            }

            selectedLogoFile = file;
            
            // Display file info
            document.getElementById('logoFileName').textContent = file.name;
            document.getElementById('logoFileSize').textContent = formatFileSize(file.size);
            logoInfo.style.display = 'block';
            logoUploadArea.style.display = 'none';

            // Update image watermark display
            const logoURL = URL.createObjectURL(file);
            const logoDisplay = document.getElementById('imageWatermarkDisplay');
            logoDisplay.src = logoURL;
            logoDisplay.style.display = 'block';
        }

        function clearVideo() {
            selectedVideoFile = null;
            videoInfo.style.display = 'none';
            videoUploadArea.style.display = 'block';
            previewSection.style.display = 'none';
            controlsSection.style.display = 'none';
            downloadBtn.style.display = 'none';
            processedVideoBlob = null;
        }

        function clearLogo() {
            selectedLogoFile = null;
            logoInfo.style.display = 'none';
            logoUploadArea.style.display = 'block';
            document.getElementById('imageWatermarkDisplay').style.display = 'none';
        }

        function updateTextWatermark() {
            const textWatermark = document.getElementById('textWatermarkDisplay');
            const text = textWatermarkInput.value;
            
            if (text.trim()) {
                textWatermark.textContent = text;
                textWatermark.style.display = 'block';
                textWatermark.style.fontSize = fontSize.value + 'px';
                textWatermark.style.color = textColor.value;
                textWatermark.style.fontFamily = fontFamily.value;
                textWatermark.style.opacity = (fontOpacity.value / 100).toString();
            } else {
                textWatermark.style.display = 'none';
            }
            
            updateWatermarkPosition();
        }

        function updateFontSize() {
            document.getElementById('fontSizeValue').textContent = fontSize.value + 'px';
            updateTextWatermark();
        }

        function updateFontOpacity() {
            document.getElementById('fontOpacityValue').textContent = fontOpacity.value + '%';
            updateTextWatermark();
        }

        function updateWatermarkPosition() {
            const overlay = document.getElementById('watermarkOverlay');
            const textWatermark = document.getElementById('textWatermarkDisplay');
            const imageWatermark = document.getElementById('imageWatermarkDisplay');
            
            // Remove existing position classes
            overlay.className = 'video-overlay';
            
            // Apply position based on current setting
            switch(currentWatermarkPosition) {
                case 'top-left':
                    overlay.style.top = '10px';
                    overlay.style.left = '10px';
                    overlay.style.transform = 'none';
                    break;
                case 'top-center':
                    overlay.style.top = '10px';
                    overlay.style.left = '50%';
                    overlay.style.transform = 'translateX(-50%)';
                    break;
                case 'top-right':
                    overlay.style.top = '10px';
                    overlay.style.right = '10px';
                    overlay.style.left = 'auto';
                    overlay.style.transform = 'none';
                    break;
                case 'middle-left':
                    overlay.style.top = '50%';
                    overlay.style.left = '10px';
                    overlay.style.transform = 'translateY(-50%)';
                    break;
                case 'center':
                    overlay.style.top = '50%';
                    overlay.style.left = '50%';
                    overlay.style.transform = 'translate(-50%, -50%)';
                    break;
                case 'middle-right':
                    overlay.style.top = '50%';
                    overlay.style.right = '10px';
                    overlay.style.left = 'auto';
                    overlay.style.transform = 'translateY(-50%)';
                    break;
                case 'bottom-left':
                    overlay.style.bottom = '10px';
                    overlay.style.top = 'auto';
                    overlay.style.left = '10px';
                    overlay.style.transform = 'none';
                    break;
                case 'bottom-center':
                    overlay.style.bottom = '10px';
                    overlay.style.top = 'auto';
                    overlay.style.left = '50%';
                    overlay.style.transform = 'translateX(-50%)';
                    break;
                case 'bottom-right':
                    overlay.style.bottom = '10px';
                    overlay.style.top = 'auto';
                    overlay.style.right = '10px';
                    overlay.style.left = 'auto';
                    overlay.style.transform = 'none';
                    break;
                default:
                    // Custom position
                    const customX = document.getElementById('customX').value;
                    const customY = document.getElementById('customY').value;
                    overlay.style.left = customX + '%';
                    overlay.style.top = customY + '%';
                    overlay.style.transform = 'translate(-50%, -50%)';
                    overlay.style.right = 'auto';
                    overlay.style.bottom = 'auto';
            }
        }

        function updateCustomPosition() {
            document.getElementById('customXValue').textContent = document.getElementById('customX').value + '%';
            document.getElementById('customYValue').textContent = document.getElementById('customY').value + '%';
            
            if (currentWatermarkPosition.includes('custom')) {
                updateWatermarkPosition();
            }
        }

        async function initializeFFmpeg() {
            try {
                updateProgress(0, 'Loading FFmpeg...');
                
                const { FFmpeg } = FFmpegWASM;
                ffmpeg = new FFmpeg();
                
                // Set up progress tracking
                ffmpeg.on('progress', ({ progress }) => {
                    const percentage = Math.round(progress * 100);
                    updateProgress(percentage, `Processing... ${percentage}%`);
                });
                
                ffmpeg.on('log', ({ message }) => {
                    console.log('FFmpeg log:', message);
                });
                
                // Load FFmpeg
                await ffmpeg.load({
                    coreURL: 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd/ffmpeg-core.js',
                    wasmURL: 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd/ffmpeg-core.wasm',
                });
                
                ffmpegLoaded = true;
                updateProgress(100, 'FFmpeg loaded successfully!');
                
            } catch (error) {
                console.error('Failed to load FFmpeg:', error);
                showError('Failed to load video processing engine. Please refresh the page and try again.');
                throw error;
            }
        }

        async function processVideo() {
            if (!selectedVideoFile) {
                showError('Please select a video file first.');
                return;
            }

            try {
                // Show progress indicator
                progressSection.style.display = 'block';
                processBtn.disabled = true;
                processBtn.textContent = 'Processing...';
                
                updateProgress(0, 'Initializing FFmpeg...');
                
                // Initialize FFmpeg if not already done
                if (!ffmpegLoaded) {
                    await initializeFFmpeg();
                }
                
                updateProgress(10, 'Preparing video...');
                
                // Clear previous files from FFmpeg FS
                try {
                    await ffmpeg.deleteFile('/input.mp4');
                    await ffmpeg.deleteFile('/logo.png');
                    await ffmpeg.deleteFile('/output.mp4');
                } catch (e) {
                    // Files might not exist, ignore errors
                }
                
                updateProgress(20, 'Loading video file...');
                
                // Write video file to FFmpeg filesystem
                const videoData = new Uint8Array(await selectedVideoFile.arrayBuffer());
                await ffmpeg.writeFile('/input.mp4', videoData);
                
                updateProgress(30, 'Processing video...');
                
                // Get video dimensions for positioning
                const videoElement = document.createElement('video');
                videoElement.src = URL.createObjectURL(selectedVideoFile);
                await new Promise((resolve) => {
                    videoElement.onloadedmetadata = resolve;
                });
                
                const videoWidth = videoElement.videoWidth;
                const videoHeight = videoElement.videoHeight;
                URL.revokeObjectURL(videoElement.src);
                
                updateProgress(40, 'Applying watermark...');
                
                // Build FFmpeg command
                let ffmpegArgs = ['-i', '/input.mp4'];
                
                // Add text watermark if provided
                const textWatermark = textWatermarkInput.value.trim();
                if (textWatermark) {
                    const fontSize = parseInt(document.getElementById('fontSize').value);
                    const opacity = parseInt(document.getElementById('fontOpacity').value) / 100;
                    const color = document.getElementById('textColor').value;
                    const font = document.getElementById('fontFamily').value.split(',')[0];
                    
                    // Calculate position
                    const position = getWatermarkPosition(videoWidth, videoHeight);
                    
                    // Escape text for FFmpeg
                    const escapedText = textWatermark.replace(/'/g, "'\\''").replace(/:/g, '\\:');
                    
                    // Build text filter
                    const textFilter = `drawtext=text='${escapedText}':fontsize=${fontSize}:fontcolor=${color}@${opacity}:x=${position.x}:y=${position.y}`;
                    ffmpegArgs.push('-vf', textFilter);
                }
                
                // Add image watermark if provided
                if (selectedLogoFile) {
                    updateProgress(50, 'Processing logo...');
                    
                    // Convert logo to PNG and write to FS
                    const logoData = new Uint8Array(await selectedLogoFile.arrayBuffer());
                    await ffmpeg.writeFile('/logo.png', logoData);
                    
                    // Get logo dimensions
                    const logoImg = new Image();
                    logoImg.src = URL.createObjectURL(selectedLogoFile);
                    await new Promise((resolve) => {
                        logoImg.onload = resolve;
                    });
                    
                    const logoWidth = logoImg.width;
                    const logoHeight = logoImg.height;
                    URL.revokeObjectURL(logoImg.src);
                    
                    updateProgress(60, 'Positioning logo...');
                    
                    const position = getImageWatermarkPosition(videoWidth, videoHeight, logoWidth, logoHeight);
                    
                    // Add image overlay filter
                    const imageFilter = `overlay=${position.x}:${position.y}:enable='between(t,0,999999)'`;
                    ffmpegArgs.push('-i', '/logo.png', '-filter_complex', ffmpegArgs.includes('-vf') ? 
                        `${ffmpegArgs[ffmpegArgs.indexOf('-vf') + 1]}.${imageFilter}` : imageFilter);
                }
                
                // Output settings
                ffmpegArgs.push('-c:v', 'libx264', '-c:a', 'copy', '-y', '/output.mp4');
                
                updateProgress(70, 'Encoding video...');
                
                // Execute FFmpeg
                await ffmpeg.exec(ffmpegArgs);
                
                updateProgress(90, 'Finalizing...');
                
                // Read the processed video
                const outputData = await ffmpeg.readFile('/output.mp4');
                processedVideoBlob = new Blob([outputData], { type: 'video/mp4' });
                
                updateProgress(100, 'Complete!');
                
                // Show download button
                downloadBtn.style.display = 'inline-block';
                processBtn.disabled = false;
                processBtn.textContent = 'üé¨ Apply Watermark';
                
                showNotification('‚úÖ Video processed successfully!');
                
                // Clean up
                try {
                    await ffmpeg.deleteFile('/output.mp4');
                } catch (e) {
                    // Ignore cleanup errors
                }
                
            } catch (error) {
                console.error('Video processing error:', error);
                showError(`Failed to process video: ${error.message}. Please try again with a different video format.`);
                
                progressSection.style.display = 'none';
                processBtn.disabled = false;
                processBtn.textContent = 'üé¨ Apply Watermark';
            }
        }

        function getWatermarkPosition(videoWidth, videoHeight) {
            const margin = 50;
            
            switch(currentWatermarkPosition) {
                case 'top-left':
                    return { x: margin, y: margin };
                case 'top-center':
                    return { x: (videoWidth / 2) - 100, y: margin };
                case 'top-right':
                    return { x: videoWidth - 200, y: margin };
                case 'middle-left':
                    return { x: margin, y: (videoHeight / 2) - 25 };
                case 'center':
                    return { x: (videoWidth / 2) - 100, y: (videoHeight / 2) - 25 };
                case 'middle-right':
                    return { x: videoWidth - 200, y: (videoHeight / 2) - 25 };
                case 'bottom-left':
                    return { x: margin, y: videoHeight - 75 };
                case 'bottom-center':
                    return { x: (videoWidth / 2) - 100, y: videoHeight - 75 };
                case 'bottom-right':
                    return { x: videoWidth - 200, y: videoHeight - 75 };
                default:
                    // Custom position
                    const customX = parseInt(document.getElementById('customX').value);
                    const customY = parseInt(document.getElementById('customY').value);
                    return { 
                        x: Math.round((customX / 100) * videoWidth),
                        y: Math.round((customY / 100) * videoHeight)
                    };
            }
        }

        function getImageWatermarkPosition(videoWidth, videoHeight, logoWidth, logoHeight) {
            const margin = 20;
            const maxLogoWidth = Math.min(200, videoWidth * 0.3);
            const maxLogoHeight = Math.min(100, videoHeight * 0.2);
            const scale = Math.min(maxLogoWidth / logoWidth, maxLogoHeight / logoHeight, 1);
            
            const scaledWidth = logoWidth * scale;
            const scaledHeight = logoHeight * scale;
            
            switch(currentWatermarkPosition) {
                case 'top-left':
                    return { x: margin, y: margin };
                case 'top-center':
                    return { x: Math.round((videoWidth - scaledWidth) / 2), y: margin };
                case 'top-right':
                    return { x: videoWidth - scaledWidth - margin, y: margin };
                case 'middle-left':
                    return { x: margin, y: Math.round((videoHeight - scaledHeight) / 2) };
                case 'center':
                    return { 
                        x: Math.round((videoWidth - scaledWidth) / 2), 
                        y: Math.round((videoHeight - scaledHeight) / 2) 
                    };
                case 'middle-right':
                    return { x: videoWidth - scaledWidth - margin, y: Math.round((videoHeight - scaledHeight) / 2) };
                case 'bottom-left':
                    return { x: margin, y: videoHeight - scaledHeight - margin };
                case 'bottom-center':
                    return { 
                        x: Math.round((videoWidth - scaledWidth) / 2), 
                        y: videoHeight - scaledHeight - margin 
                    };
                case 'bottom-right':
                    return { 
                        x: videoWidth - scaledWidth - margin, 
                        y: videoHeight - scaledHeight - margin 
                    };
                default:
                    // Custom position
                    const customX = parseInt(document.getElementById('customX').value);
                    const customY = parseInt(document.getElementById('customY').value);
                    return { 
                        x: Math.round((customX / 100) * videoWidth - scaledWidth / 2),
                        y: Math.round((customY / 100) * videoHeight - scaledHeight / 2)
                    };
            }
        }

        function updateProgress(percentage, status) {
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressStatus').textContent = status;
            document.getElementById('progressDetails').textContent = `Progress: ${percentage}% - ${status}`;
        }

        function downloadVideo() {
            if (!processedVideoBlob) {
                showError('No processed video available for download.');
                return;
            }

            const url = URL.createObjectURL(processedVideoBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'watermarked_' + selectedVideoFile.name.replace(/\.[^/.]+$/, '.mp4');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üì• Video download started!');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showNotification(message) {
            // Create and show a temporary notification
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--color-success);
                color: white;
                padding: 12px 20px;
                border-radius: var(--radius-button);
                font-weight: 500;
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        function showError(message) {
            // Create and show a temporary error notification
            const notification = document.createElement('div');
            notification.className = 'notification error';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--color-error);
                color: white;
                padding: 12px 20px;
                border-radius: var(--radius-button);
                font-weight: 500;
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 5000);
        }

        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>

    <style>
        /* Tool-specific styles */
        .upload-section, .preview-section, .controls-section {
            background: var(--color-surface);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-card);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .input-label {
            display: block;
            font-weight: var(--font-weight-medium);
            color: var(--color-neutral-700);
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-body);
        }

        .file-upload-area {
            border: 2px dashed var(--color-neutral-300);
            border-radius: var(--radius-card);
            padding: var(--spacing-2xl);
            text-align: center;
            transition: all var(--duration-standard);
            cursor: pointer;
        }

        .file-upload-area:hover, .file-upload-area.drag-over {
            border-color: var(--color-primary-500);
            background: var(--color-primary-50);
        }

        .upload-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-md);
        }

        .upload-content.small {
            padding: var(--spacing-md);
        }

        .upload-icon {
            font-size: 3rem;
        }

        .upload-icon.small {
            font-size: 2rem;
        }

        .upload-text h3 {
            font-size: var(--font-size-body-large);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-800);
            margin-bottom: var(--spacing-xs);
        }

        .upload-text p {
            color: var(--color-neutral-600);
            margin-bottom: var(--spacing-sm);
        }

        .upload-text.small p {
            margin-bottom: 0;
            font-size: var(--font-size-small);
        }

        .file-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--color-neutral-50);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-button);
            padding: var(--spacing-sm) var(--spacing-md);
        }

        .file-details {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .file-name {
            font-weight: var(--font-weight-medium);
            color: var(--color-neutral-800);
        }

        .file-size {
            font-size: var(--font-size-small);
            color: var(--color-neutral-600);
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: #000;
            border-radius: var(--radius-card);
            overflow: hidden;
        }

        .video-player {
            width: 100%;
            height: auto;
            display: block;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .text-watermark {
            position: absolute;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            white-space: nowrap;
            user-select: none;
        }

        .image-watermark {
            position: absolute;
            max-width: 200px;
            max-height: 100px;
            object-fit: contain;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
        }

        .control-group {
            background: var(--color-neutral-50);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-card);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .control-group-title {
            font-size: var(--font-size-body-large);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-900);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .form-label {
            font-size: var(--font-size-body);
            font-weight: var(--font-weight-medium);
            color: var(--color-neutral-700);
        }

        .form-input, .form-select {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-input);
            font-size: var(--font-size-body);
            transition: border-color var(--duration-fast);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--color-primary-500);
            box-shadow: 0 0 0 3px var(--color-primary-100);
        }

        .form-range {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--color-neutral-200);
            outline: none;
            -webkit-appearance: none;
        }

        .form-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-primary-500);
            cursor: pointer;
        }

        .form-range::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-primary-500);
            cursor: pointer;
            border: none;
        }

        .form-color {
            width: 50px;
            height: 40px;
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-input);
            cursor: pointer;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }

        .range-value {
            font-size: var(--font-size-small);
            color: var(--color-neutral-600);
            font-weight: var(--font-weight-medium);
        }

        .position-presets {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .position-btn {
            padding: var(--spacing-sm);
            border: 2px solid var(--color-neutral-300);
            border-radius: var(--radius-button);
            background: var(--color-surface);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .position-btn:hover {
            border-color: var(--color-primary-400);
        }

        .position-btn.active {
            border-color: var(--color-primary-500);
            background: var(--color-primary-100);
        }

        .process-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
        }

        .btn-large {
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-body-large);
        }

        .progress-section {
            background: var(--color-neutral-50);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-card);
            padding: var(--spacing-lg);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .progress-header h4 {
            font-size: var(--font-size-body-large);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-900);
        }

        .progress-status {
            font-size: var(--font-size-small);
            color: var(--color-neutral-600);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--color-neutral-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: var(--spacing-md);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary-500), var(--color-primary-600));
            transition: width var(--duration-standard);
        }

        .progress-details {
            font-size: var(--font-size-small);
            color: var(--color-neutral-600);
            text-align: center;
        }

        .privacy-notice {
            background: linear-gradient(135deg, var(--color-primary-50), var(--color-secondary-50));
            border: 1px solid var(--color-primary-200);
            border-radius: var(--radius-card);
            padding: var(--spacing-lg);
            margin-top: var(--spacing-xl);
        }

        .privacy-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .privacy-icon {
            font-size: 2.5rem;
            flex-shrink: 0;
        }

        .privacy-text h4 {
            font-size: var(--font-size-body-large);
            font-weight: var(--font-weight-semibold);
            color: var(--color-primary-700);
            margin-bottom: var(--spacing-xs);
        }

        .privacy-text p {
            color: var(--color-primary-600);
            font-size: var(--font-size-body);
            margin: 0;
            line-height: 1.5;
        }

        .related-tools {
            padding: var(--spacing-3xl) 0;
            background: var(--color-neutral-50);
        }

        .related-title {
            font-size: var(--font-size-subtitle);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-900);
            margin-bottom: var(--spacing-xl);
            text-align: center;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .related-card {
            background: var(--color-surface);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-card);
            padding: var(--spacing-lg);
            text-decoration: none;
            transition: all var(--duration-standard) var(--easing-standard);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .related-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-card-hover);
            border-color: var(--color-primary-100);
        }

        .related-icon {
            font-size: 2em;
            flex-shrink: 0;
        }

        .related-content h4 {
            font-size: var(--font-size-body-large);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .related-content p {
            color: var(--color-neutral-700);
            font-size: var(--font-size-body);
            margin: 0;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .position-presets {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .process-actions {
                flex-direction: column;
            }
            
            .privacy-content {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</body>
</html>