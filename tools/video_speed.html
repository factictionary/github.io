<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Speed Controller | Adjust Video Playback Speed Online | Factictionary</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Free online video speed controller tool. Adjust video playback speed from 0.25x to 4x with audio sync options. Perfect for content creators, educators, and students. 100% privacy-protected, works entirely in your browser.">
    <meta name="keywords" content="video speed controller, video player speed, adjust video speed, slow motion video, fast forward video, video editing tool, video playback speed, change video speed online">
    <meta name="author" content="Factictionary Team">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Video Speed Controller | Adjust Video Playback Speed Online | Factictionary">
    <meta property="og:description" content="Professional video speed controller with real-time preview and audio sync options. Adjust playback speed from 0.25x to 4x. Free and privacy-protected.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://factictionary.github.io/tools/video_speed.html">
    <meta property="og:image" content="https://factictionary.github.io/assets/images/modern_educational_platform_hero_illustration.jpg">
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Video Speed Controller | Factictionary">
    <meta name="twitter:description" content="Adjust video playback speed from 0.25x to 4x with audio sync options. Free and privacy-protected.">
    <meta name="twitter:image" content="https://factictionary.github.io/assets/images/modern_educational_platform_hero_illustration.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://factictionary.github.io/tools/video_speed.html">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/assets/css/style.css">
    
    <!-- FFmpeg.wasm Library -->
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/umd/ffmpeg.min.js"></script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Factictionary Video Speed Controller",
        "description": "Free online video speed controller tool to adjust video playback speed from 0.25x to 4x with audio sync options.",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "provider": {
            "@type": "Organization",
            "name": "Factictionary"
        }
    }
    </script>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main" class="skip-link">Skip to main content</a>
    
    <!-- Navigation -->
    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div class="nav-container">
            <a href="/" class="logo">Factictionary</a>
            
            <ul class="nav-links">
                <li><a href="/blog/" class="nav-link">Blog</a></li>
                <li><a href="/tools/" class="nav-link active">Tools</a></li>
                <li><a href="/about.html" class="nav-link">About</a></li>
                <li><a href="/contact.html" class="nav-link">Contact</a></li>
            </ul>
            
            <div class="nav-cta">
                <a href="/blog/" class="btn btn-primary">Read Articles</a>
            </div>
            
            <button class="menu-toggle" aria-label="Toggle mobile menu" aria-expanded="false">
                <span>‚ò∞</span>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main">
        <!-- AdSense Container -->
        <div class="ad-container top-ad">
            <!-- AdSense code will be inserted here -->
        </div>

        <!-- Tool Header -->
        <header class="tool-header">
            <div class="container">
                <div class="tool-header-content">
                    <h3 class="tool-title">Video Speed Controller</h3>
                    <p class="tool-subtitle">Adjust video playback speed from 0.25x to 4x with real-time preview and audio sync options. Perfect for content creators, educators, and students who need to control video speed efficiently.</p>
                    <div class="privacy-badge">üîí 100% Privacy Protected</div>
                    <div class="tool-features">
                        <span class="feature-tag">Real-time Preview</span>
                        <span class="feature-tag">Speed Control</span>
                        <span class="feature-tag">Audio Sync</span>
                        <span class="feature-tag">Download Output</span>
                        <span class="feature-tag">Browser Processing</span>
                        <span class="feature-tag">Multiple Formats</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tool Workspace -->
        <section class="tool-workspace">
            <div class="container">
                <!-- Video Upload Section -->
                <div class="input-section">
                    <label class="input-label">Upload Video</label>
                    <div class="video-upload-area" id="videoUploadArea">
                        <div class="upload-content">
                            <div class="upload-icon">üìπ</div>
                            <h3>Drop your video here</h3>
                            <p>or click to browse files</p>
                            <p class="upload-info">Supported formats: MP4, MOV, AVI, MKV, WebM (max 500MB)</p>
                        </div>
                        <input type="file" id="videoInput" accept="video/*" style="display: none;">
                    </div>
                    <div id="videoInfo" class="video-info" style="display: none;">
                        <div class="file-details">
                            <span class="file-name" id="fileName"></span>
                            <span class="file-size" id="fileSize"></span>
                            <span class="file-duration" id="fileDuration"></span>
                        </div>
                    </div>
                </div>

                <!-- Speed Control Section -->
                <div class="speed-control-section">
                    <h3 class="section-title">Speed Control</h3>
                    <div class="speed-control-content">
                        <div class="speed-slider-container">
                            <label class="speed-label">Playback Speed: <span id="speedValue">1.0x</span></label>
                            <input type="range" id="speedSlider" class="speed-slider" min="0.25" max="4" step="0.25" value="1">
                            <div class="speed-markers">
                                <span>0.25x</span>
                                <span>1.0x</span>
                                <span>4.0x</span>
                            </div>
                        </div>
                        
                        <div class="preset-buttons">
                            <button class="preset-btn" data-speed="0.5">0.5x</button>
                            <button class="preset-btn active" data-speed="1.0">1.0x</button>
                            <button class="preset-btn" data-speed="1.5">1.5x</button>
                            <button class="preset-btn" data-speed="2.0">2.0x</button>
                        </div>
                    </div>
                </div>

                <!-- Audio Sync Options -->
                <div class="audio-sync-section">
                    <h3 class="section-title">Audio Sync Options</h3>
                    <div class="audio-options">
                        <label class="audio-option">
                            <input type="radio" name="audioMode" value="preserve" checked>
                            <span class="audio-option-content">
                                <strong>Preserve Audio Pitch</strong>
                                <small>Keep original audio pitch (sounds natural at different speeds)</small>
                            </span>
                        </label>
                        <label class="audio-option">
                            <input type="radio" name="audioMode" value="stretch">
                            <span class="audio-option-content">
                                <strong>Stretch Audio</strong>
                                <small>Adjust audio duration to match video speed changes</small>
                            </span>
                        </label>
                        <label class="audio-option">
                            <input type="radio" name="audioMode" value="remove">
                            <span class="audio-option-content">
                                <strong>Remove Audio</strong>
                                <small>Create video-only version without audio track</small>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Process Button -->
                <div class="process-button-section">
                    <button class="btn btn-primary btn-large" id="processVideoBtn" disabled>
                        ‚ö° Process Video with Speed Adjustment
                    </button>
                    <p class="process-note">Click to generate a new video with your selected speed and audio settings</p>
                    <div class="processing-warning">
                        <p><strong>‚ö†Ô∏è Note:</strong> Video processing runs entirely in your browser and may take several minutes for large files. Please keep this tab open during processing.</p>
                    </div>
                </div>

                <!-- Video Preview Section -->
                <div class="preview-section">
                    <h3 class="section-title">Real-time Preview</h3>
                    <div class="preview-container">
                        <div class="video-container">
                            <video id="videoPreview" controls style="display: none;">
                                Your browser does not support the video tag.
                            </video>
                            <div class="preview-placeholder" id="previewPlaceholder">
                                <div class="preview-content">
                                    <div class="preview-icon">üìπ</div>
                                    <p>Upload a video to see preview with speed adjustment</p>
                                </div>
                            </div>
                        </div>
                        <div class="preview-controls">
                            <button class="btn btn-secondary" id="playPauseBtn" disabled>‚ñ∂Ô∏è Play</button>
                            <div class="time-display">
                                <span id="currentTime">00:00</span> / <span id="totalTime">00:00</span>
                            </div>
                            <button class="btn btn-secondary" id="fullscreenBtn" disabled>‚õ∂ Fullscreen</button>
                        </div>
                    </div>
                </div>

                <!-- Processing Section -->
                <div class="processing-section" id="processingSection" style="display: none;">
                    <h3 class="section-title">Processing Video</h3>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                        <div class="progress-text" id="progressText">Initializing...</div>
                        <div class="progress-details" id="progressDetails">Please wait while we process your video</div>
                    </div>
                </div>

                <!-- Output Section -->
                <div class="output-section" id="outputSection" style="display: none;">
                    <h3 class="section-title">Download Result</h3>
                    <div class="output-container">
                        <div class="output-video">
                            <video id="outputVideo" controls>
                                Your browser does not support the video tag.
                            </video>
                        </div>
                        <div class="output-info">
                            <div class="output-stats">
                                <div class="stat-item">
                                    <span class="stat-label">Original Duration:</span>
                                    <span class="stat-value" id="originalDuration">00:00</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">New Duration:</span>
                                    <span class="stat-value" id="newDuration">00:00</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Speed Applied:</span>
                                    <span class="stat-value" id="appliedSpeed">1.0x</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Audio Mode:</span>
                                    <span class="stat-value" id="audioModeText">Preserve Pitch</span>
                                </div>
                            </div>
                            <div class="output-actions">
                                <button class="btn btn-primary" id="downloadBtn">üì• Download Video</button>
                                <button class="btn btn-secondary" id="processAnotherBtn">üîÑ Process Another Video</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Privacy Notice -->
                <div class="privacy-notice">
                    <div class="privacy-content">
                        <div class="privacy-icon">üîí</div>
                        <div class="privacy-text">
                            <h4>Privacy Protected</h4>
                            <p>Your video is processed entirely in your browser. No files are uploaded to our servers, ensuring complete privacy and security of your content.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AdSense Container -->
        <div class="ad-container bottom-ad">
            <!-- AdSense code will be inserted here -->
        </div>

        <!-- Related Tools -->
        <section class="related-tools">
            <div class="container">
                <h3 class="related-title">More Video/Audio Tools</h3>
                <div class="related-grid">
                    <a href="video_compressor.html" class="related-card">
                        <div class="related-icon">üóúÔ∏è</div>
                        <div class="related-content">
                            <h4>Video Compressor</h4>
                            <p>Compress video files to reduce size while maintaining quality</p>
                        </div>
                    </a>
                    <a href="video_converter.html" class="related-card">
                        <div class="related-icon">üîÑ</div>
                        <div class="related-content">
                            <h4>Video Converter</h4>
                            <p>Convert videos between different formats (MP4, AVI, MOV, etc.)</p>
                        </div>
                    </a>
                    <a href="audio_trimmer.html" class="related-card">
                        <div class="related-icon">‚úÇÔ∏è</div>
                        <div class="related-content">
                            <h4>Audio Trimmer</h4>
                            <p>Trim and cut audio files with precision controls</p>
                        </div>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Content</h4>
                    <ul>
                        <li><a href="/blog/">All Articles</a></li>
                        <li><a href="/blog/?category=productivity">Productivity</a></li>
                        <li><a href="/blog/?category=technology">Technology</a></li>
                        <li><a href="/blog/?category=business">Business</a></li>
                        <li><a href="/blog/?category=learning">Learning</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Tools</h4>
                    <ul>
                        <li><a href="/tools/">All Tools</a></li>
                        <li><a href="/tools/categories/image.html">Image Tools</a></li>
                        <li><a href="/tools/categories/pdf.html">PDF Tools</a></li>
                        <li><a href="/tools/categories/video.html">Video/Audio Tools</a></li>
                        <li><a href="/tools/categories/text.html">Text Tools</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="/about.html">About</a></li>
                        <li><a href="/contact.html">Contact</a></li>
                        <li><a href="/privacy.html">Privacy Policy</a></li>
                        <li><a href="/terms.html">Terms of Service</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Connect</h4>
                    <ul>
                        <li><a href="mailto:factictionary@gmail.com">Email Us</a></li>
                        <li><a href="/contact.html">Support</a></li>
                        <li><a href="#" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">Back to Top</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Factictionary. All rights reserved. Privacy-first educational platform for the modern web.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Video Speed Controller functionality
        document.addEventListener('DOMContentLoaded', function() {
            initializeVideoSpeedController();
        });

        let currentVideoFile = null;
        let ffmpeg = null;
        let isProcessing = false;

        async function initializeVideoSpeedController() {
            // Initialize FFmpeg.wasm
            const ffmpegLoaded = await initializeFFmpeg();
            
            // Setup event listeners
            setupEventListeners();
            
            // Enable process button if FFmpeg loaded successfully
            if (ffmpegLoaded) {
                console.log('Video speed controller ready!');
            }
        }

        async function initializeFFmpeg() {
            try {
                updateProgress(5, 'Loading FFmpeg...');
                ffmpeg = new FFmpeg();
                
                // Set up progress tracking
                ffmpeg.on('progress', ({ progress }) => {
                    updateProgress(5 + (progress * 80), 'Processing video...');
                });
                
                ffmpeg.on('log', ({ message }) => {
                    console.log('FFmpeg:', message);
                });

                // Load FFmpeg
                const baseURL = 'https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/umd';
                await ffmpeg.load({
                    coreURL: `${baseURL}/ffmpeg-core.js`,
                    wasmURL: `${baseURL}/ffmpeg-core.wasm`,
                });
                
                updateProgress(10, 'FFmpeg ready!');
                console.log('FFmpeg.wasm loaded successfully');
                return true;
            } catch (error) {
                console.error('Failed to load FFmpeg:', error);
                showError('Failed to load video processing engine. Please refresh the page and try again.');
                return false;
            }
        }

        function setupEventListeners() {
            // Video upload handling
            const uploadArea = document.getElementById('videoUploadArea');
            const videoInput = document.getElementById('videoInput');
            
            uploadArea.addEventListener('click', () => videoInput.click());
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            videoInput.addEventListener('change', handleVideoSelect);
            
            // Speed control
            const speedSlider = document.getElementById('speedSlider');
            const speedValue = document.getElementById('speedValue');
            const presetButtons = document.querySelectorAll('.preset-btn');
            
            speedSlider.addEventListener('input', (e) => {
                const speed = parseFloat(e.target.value);
                updateSpeedDisplay(speed);
                updatePresetButtons(speed);
                if (currentVideoFile) {
                    applySpeedToPreview(speed);
                }
            });
            
            presetButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const speed = parseFloat(e.target.dataset.speed);
                    speedSlider.value = speed;
                    updateSpeedDisplay(speed);
                    updatePresetButtons(speed);
                    if (currentVideoFile) {
                        applySpeedToPreview(speed);
                    }
                });
            });
            
            // Video preview controls
            const videoPreview = document.getElementById('videoPreview');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            
            videoPreview.addEventListener('timeupdate', updateTimeDisplay);
            videoPreview.addEventListener('loadedmetadata', updateVideoInfo);
            playPauseBtn.addEventListener('click', togglePlayPause);
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            
            // Process video
            document.getElementById('processVideoBtn').addEventListener('click', processVideo);
            document.getElementById('processAnotherBtn').addEventListener('click', resetTool);
            document.getElementById('downloadBtn').addEventListener('click', downloadProcessedVideo);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('video/')) {
                processVideoFile(files[0]);
            }
        }

        function handleVideoSelect(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('video/')) {
                processVideoFile(file);
            }
        }

        function processVideoFile(file) {
            // Validate file size (limit to 500MB for performance)
            const maxSize = 500 * 1024 * 1024; // 500MB
            if (file.size > maxSize) {
                showError('File too large. Please use a video file smaller than 500MB.');
                return;
            }
            
            // Validate file type
            const supportedFormats = ['video/mp4', 'video/mov', 'video/avi', 'video/mkv', 'video/webm'];
            if (!supportedFormats.includes(file.type)) {
                showError('Unsupported video format. Please use MP4, MOV, AVI, MKV, or WebM files.');
                return;
            }
            
            currentVideoFile = file;
            const videoInfo = document.getElementById('videoInfo');
            const previewPlaceholder = document.getElementById('previewPlaceholder');
            const videoPreview = document.getElementById('videoPreview');
            
            // Display file info
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            
            // Show video in preview
            const videoURL = URL.createObjectURL(file);
            videoPreview.src = videoURL;
            videoPreview.style.display = 'block';
            previewPlaceholder.style.display = 'none';
            
            // Enable controls
            document.getElementById('playPauseBtn').disabled = false;
            document.getElementById('fullscreenBtn').disabled = false;
            document.getElementById('processVideoBtn').disabled = !ffmpeg;
            
            videoInfo.style.display = 'block';
            
            showNotification('üìπ Video loaded successfully!');
        }

        function updateSpeedDisplay(speed) {
            document.getElementById('speedValue').textContent = speed.toFixed(2) + 'x';
        }

        function updatePresetButtons(selectedSpeed) {
            const presetButtons = document.querySelectorAll('.preset-btn');
            presetButtons.forEach(btn => {
                const btnSpeed = parseFloat(btn.dataset.speed);
                if (Math.abs(btnSpeed - selectedSpeed) < 0.01) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function applySpeedToPreview(speed) {
            const videoPreview = document.getElementById('videoPreview');
            videoPreview.playbackRate = speed;
        }

        function updateTimeDisplay() {
            const videoPreview = document.getElementById('videoPreview');
            const currentTime = videoPreview.currentTime;
            const duration = videoPreview.duration;
            
            document.getElementById('currentTime').textContent = formatTime(currentTime);
            document.getElementById('totalTime').textContent = formatTime(duration);
        }

        function updateVideoInfo() {
            const videoPreview = document.getElementById('videoPreview');
            const duration = videoPreview.duration;
            document.getElementById('fileDuration').textContent = formatTime(duration);
            
            // Also update original duration in output stats if processing has been done
            if (document.getElementById('outputSection').style.display !== 'none') {
                document.getElementById('originalDuration').textContent = formatTime(duration);
            }
        }

        function togglePlayPause() {
            const videoPreview = document.getElementById('videoPreview');
            const playPauseBtn = document.getElementById('playPauseBtn');
            
            if (videoPreview.paused) {
                videoPreview.play();
                playPauseBtn.textContent = '‚è∏Ô∏è Pause';
            } else {
                videoPreview.pause();
                playPauseBtn.textContent = '‚ñ∂Ô∏è Play';
            }
        }

        function toggleFullscreen() {
            const videoPreview = document.getElementById('videoPreview');
            
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                videoPreview.requestFullscreen();
            }
        }

        async function processVideo() {
            if (!currentVideoFile || isProcessing || !ffmpeg) return;
            
            isProcessing = true;
            const processingSection = document.getElementById('processingSection');
            const outputSection = document.getElementById('outputSection');
            
            // Show processing section
            processingSection.style.display = 'block';
            outputSection.style.display = 'none';
            
            try {
                updateProgress(5, 'Preparing video...');
                
                // Read video file
                const videoData = new Uint8Array(await currentVideoFile.arrayBuffer());
                const inputFileName = 'input.' + currentVideoFile.name.split('.').pop();
                const outputFileName = 'output.mp4';
                
                // Write input file to FFmpeg filesystem
                ffmpeg.FS('writeFile', inputFileName, videoData);
                
                // Get processing options
                const speed = parseFloat(document.getElementById('speedSlider').value);
                const audioMode = document.querySelector('input[name="audioMode"]:checked').value;
                
                updateProgress(10, 'Applying speed and audio settings...');
                
                // Build FFmpeg command based on audio mode
                let ffmpegArgs;
                
                switch (audioMode) {
                    case 'preserve':
                        // Preserve audio pitch (atempo filter for speed, pitch preserved)
                        updateProgress(15, 'Applying speed with audio pitch preservation...', 'Using atempo filter to maintain natural sound');
                        ffmpegArgs = [
                            '-i', inputFileName,
                            '-filter:v', `setpts=${1/speed}*PTS`,
                            '-filter:a', `atempo=${speed}`,
                            '-c:v', 'libx264',
                            '-c:a', 'aac',
                            '-strict', 'experimental',
                            outputFileName
                        ];
                        break;
                        
                    case 'stretch':
                        // Stretch audio to match video duration
                        updateProgress(15, 'Applying speed with audio stretching...', 'Adjusting audio duration to match video');
                        ffmpegArgs = [
                            '-i', inputFileName,
                            '-filter:v', `setpts=${1/speed}*PTS`,
                            '-filter:a', `atempo=${speed}`,
                            '-c:v', 'libx264',
                            '-c:a', 'aac',
                            '-strict', 'experimental',
                            outputFileName
                        ];
                        break;
                        
                    case 'remove':
                        // Remove audio entirely
                        updateProgress(15, 'Removing audio track...', 'Creating video-only output');
                        ffmpegArgs = [
                            '-i', inputFileName,
                            '-an', // Remove audio
                            '-c:v', 'libx264',
                            outputFileName
                        ];
                        break;
                        
                    default:
                        throw new Error('Invalid audio mode');
                }
                
                updateProgress(20, 'Starting video processing...', 'This may take a few moments depending on video size');
                
                // Execute FFmpeg command
                await ffmpeg.run(...ffmpegArgs);
                
                updateProgress(85, 'Finalizing video...', 'Almost ready!');
                
                // Read output file
                const outputData = ffmpeg.FS('readFile', outputFileName);
                
                // Create blob and URL for download
                const outputBlob = new Blob([outputData.buffer], { type: 'video/mp4' });
                const outputUrl = URL.createObjectURL(outputBlob);
                
                // Clean up filesystem
                ffmpeg.FS('unlink', inputFileName);
                ffmpeg.FS('unlink', outputFileName);
                
                updateProgress(100, 'Complete!', 'Your video is ready for download');
                
                // Store output for download
                window.processedVideoBlob = outputBlob;
                window.processedVideoUrl = outputUrl;
                
                // Show output section
                setTimeout(() => {
                    processingSection.style.display = 'none';
                    showOutputSection(outputUrl, speed, audioMode);
                }, 1000);
                
            } catch (error) {
                console.error('Video processing error:', error);
                
                // Clean up filesystem on error
                try {
                    if (ffmpeg) {
                        ffmpeg.FS('unlink', 'input.' + currentVideoFile.name.split('.').pop());
                        ffmpeg.FS('unlink', 'output.mp4');
                    }
                } catch (cleanupError) {
                    console.warn('Cleanup error:', cleanupError);
                }
                
                let errorMessage = 'Failed to process video. ';
                
                if (error.message.includes('Invalid argument')) {
                    errorMessage += 'The video format may not be supported or the file may be corrupted.';
                } else if (error.message.includes('Memory')) {
                    errorMessage += 'The video file is too large to process in your browser. Try a smaller file.';
                } else if (error.message.includes('Output file')) {
                    errorMessage += 'There was an issue creating the output file. Please try again.';
                } else {
                    errorMessage += 'Please try a different video or settings.';
                }
                
                showError(errorMessage);
            } finally {
                isProcessing = false;
                document.getElementById('processVideoBtn').disabled = false;
            }
        }

        function updateProgress(percentage, status, details) {
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = status;
            if (details) {
                document.getElementById('progressDetails').textContent = details;
            }
        }



        function showOutputSection(outputUrl, speed, audioMode) {
            const outputSection = document.getElementById('outputSection');
            const videoPreview = document.getElementById('videoPreview');
            const outputVideo = document.getElementById('outputVideo');
            
            // Update output info
            document.getElementById('appliedSpeed').textContent = speed.toFixed(1) + 'x';
            document.getElementById('audioModeText').textContent = getAudioModeText(audioMode);
            
            // Update duration info
            const originalDuration = videoPreview.duration;
            const newDuration = originalDuration / speed;
            document.getElementById('originalDuration').textContent = formatTime(originalDuration);
            document.getElementById('newDuration').textContent = formatTime(newDuration);
            
            // Show processed video
            outputVideo.src = outputUrl;
            outputVideo.load();
            
            outputSection.style.display = 'block';
            
            showNotification('üéâ Video processed successfully!');
        }

        function getAudioModeText(mode) {
            const modes = {
                'preserve': 'Preserve Pitch',
                'stretch': 'Stretch Audio',
                'remove': 'No Audio'
            };
            return modes[mode] || 'Preserve Pitch';
        }

        function downloadProcessedVideo() {
            if (!window.processedVideoBlob) {
                showError('No processed video available for download');
                return;
            }
            
            const link = document.createElement('a');
            const speed = parseFloat(document.getElementById('speedSlider').value);
            const audioMode = document.querySelector('input[name="audioMode"]:checked').value;
            
            // Create download URL
            const downloadUrl = URL.createObjectURL(window.processedVideoBlob);
            link.href = downloadUrl;
            link.download = currentVideoFile.name.replace(/\.[^/.]+$/, `_${speed}x_${audioMode}.mp4`);
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Clean up URL
            setTimeout(() => URL.revokeObjectURL(downloadUrl), 100);
            
            showNotification('üì• Video download started!');
        }

        function resetTool() {
            // Clean up processed video resources
            if (window.processedVideoUrl) {
                URL.revokeObjectURL(window.processedVideoUrl);
            }
            window.processedVideoBlob = null;
            window.processedVideoUrl = null;
            
            // Reset all sections
            document.getElementById('videoInput').value = '';
            document.getElementById('videoInfo').style.display = 'none';
            document.getElementById('previewPlaceholder').style.display = 'flex';
            document.getElementById('videoPreview').style.display = 'none';
            document.getElementById('outputSection').style.display = 'none';
            document.getElementById('processingSection').style.display = 'none';
            document.getElementById('playPauseBtn').disabled = true;
            document.getElementById('fullscreenBtn').disabled = true;
            document.getElementById('processVideoBtn').disabled = true;
            
            // Reset controls
            document.getElementById('speedSlider').value = 1;
            updateSpeedDisplay(1);
            updatePresetButtons(1);
            
            // Reset audio mode
            document.querySelector('input[name="audioMode"][value="preserve"]').checked = true;
            
            currentVideoFile = null;
            
            showNotification('üîÑ Ready for new video');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--color-success);
                color: white;
                padding: 12px 20px;
                border-radius: var(--radius-button);
                font-weight: 500;
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        function showError(message) {
            const notification = document.createElement('div');
            notification.className = 'notification error';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--color-error);
                color: white;
                padding: 12px 20px;
                border-radius: var(--radius-button);
                font-weight: 500;
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 5000);
        }

        // Mobile menu functionality
        const menuToggle = document.querySelector('.menu-toggle');
        const navLinks = document.querySelector('.nav-links');
        
        menuToggle.addEventListener('click', () => {
            const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
            menuToggle.setAttribute('aria-expanded', !isExpanded);
            navLinks.classList.toggle('active');
        });

        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>

    <style>
        /* Tool-specific styles */
        .video-upload-area {
            background: var(--color-surface);
            border: 2px dashed var(--color-neutral-300);
            border-radius: var(--radius-card);
            padding: var(--spacing-2xl);
            text-align: center;
            cursor: pointer;
            transition: all var(--duration-fast);
            margin-bottom: var(--spacing-md);
        }

        .video-upload-area:hover,
        .video-upload-area.drag-over {
            border-color: #F59E0B;
            background: #FFF7ED;
        }

        .upload-content h3 {
            font-size: var(--font-size-body-large);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .upload-content p {
            color: var(--color-neutral-700);
            margin-bottom: var(--spacing-sm);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        .upload-info {
            font-size: var(--font-size-small);
            color: var(--color-neutral-600);
            margin-top: var(--spacing-sm);
        }

        .video-info {
            background: var(--color-neutral-50);
            border-radius: var(--radius-button);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .file-details {
            display: flex;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .file-details span {
            font-size: var(--font-size-body);
            color: var(--color-neutral-700);
        }

        .speed-control-section,
        .audio-sync-section,
        .preview-section {
            background: var(--color-surface);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-card);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .speed-control-content {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .speed-slider-container {
            flex: 1;
        }

        .speed-label {
            display: block;
            font-weight: var(--font-weight-medium);
            color: var(--color-neutral-700);
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-body);
        }

        .speed-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--color-neutral-200);
            outline: none;
            -webkit-appearance: none;
            margin-bottom: var(--spacing-sm);
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #F59E0B;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: var(--shadow-small);
        }

        .speed-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #F59E0B;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: var(--shadow-small);
        }

        .speed-markers {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-small);
            color: var(--color-neutral-600);
        }

        .preset-buttons {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--color-neutral-300);
            background: var(--color-neutral-50);
            color: var(--color-neutral-700);
            border-radius: var(--radius-button);
            cursor: pointer;
            font-size: var(--font-size-body);
            font-weight: var(--font-weight-medium);
            transition: all var(--duration-fast);
        }

        .preset-btn:hover {
            border-color: #F59E0B;
            background: #FFF7ED;
        }

        .preset-btn.active {
            background: #F59E0B;
            color: white;
            border-color: #F59E0B;
        }

        .audio-options {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .audio-option {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-button);
            cursor: pointer;
            transition: all var(--duration-fast);
        }

        .audio-option:hover {
            border-color: #F59E0B;
            background: #FFF7ED;
        }

        .audio-option input[type="radio"] {
            margin-top: 2px;
            accent-color: #F59E0B;
        }

        .audio-option-content {
            flex: 1;
        }

        .audio-option-content strong {
            display: block;
            font-size: var(--font-size-body);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .audio-option-content small {
            color: var(--color-neutral-600);
            font-size: var(--font-size-small);
        }

        .process-button-section {
            text-align: center;
            background: var(--color-surface);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-card);
            padding: var(--spacing-2xl);
            margin-bottom: var(--spacing-xl);
        }

        .btn-large {
            padding: var(--spacing-lg) var(--spacing-2xl);
            font-size: var(--font-size-body-large);
            font-weight: var(--font-weight-semibold);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn:disabled:hover {
            transform: none !important;
        }

        .process-note {
            margin-top: var(--spacing-md);
            color: var(--color-neutral-600);
            font-size: var(--font-size-body);
        }

        .processing-warning {
            margin-top: var(--spacing-lg);
            padding: var(--spacing-md);
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            border-radius: var(--radius-button);
            text-align: left;
        }

        .processing-warning p {
            margin: 0;
            color: #92400E;
            font-size: var(--font-size-small);
        }

        .processing-warning strong {
            color: #B45309;
        }

        .preview-container {
            background: var(--color-neutral-50);
            border-radius: var(--radius-card);
            padding: var(--spacing-lg);
        }

        .video-container {
            margin-bottom: var(--spacing-md);
            position: relative;
        }

        .video-container video {
            width: 100%;
            max-height: 400px;
            border-radius: var(--radius-button);
        }

        .preview-placeholder {
            background: var(--color-neutral-100);
            border: 2px dashed var(--color-neutral-300);
            border-radius: var(--radius-button);
            padding: var(--spacing-2xl);
            text-align: center;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        .preview-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .time-display {
            font-size: var(--font-size-body);
            color: var(--color-neutral-700);
            font-weight: var(--font-weight-medium);
        }

        .processing-section {
            background: var(--color-surface);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-card);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
            text-align: center;
        }

        .progress-container {
            max-width: 400px;
            margin: 0 auto;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--color-neutral-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: var(--spacing-md);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #F59E0B, #D97706);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: var(--font-size-body-large);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .progress-details {
            font-size: var(--font-size-body);
            color: var(--color-neutral-600);
        }

        .output-section {
            background: var(--color-surface);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-card);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .output-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-xl);
            align-items: start;
        }

        .output-video video {
            width: 100%;
            border-radius: var(--radius-button);
        }

        .output-info {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .output-stats {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .output-stats .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--color-neutral-200);
        }

        .output-stats .stat-item:last-child {
            border-bottom: none;
        }

        .output-stats .stat-label {
            font-size: var(--font-size-body);
            color: var(--color-neutral-700);
        }

        .output-stats .stat-value {
            font-size: var(--font-size-body);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-900);
        }

        .output-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .privacy-notice {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border: 1px solid #F59E0B;
            border-radius: var(--radius-card);
            padding: var(--spacing-lg);
        }

        .privacy-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .privacy-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .privacy-text h4 {
            font-size: var(--font-size-body-large);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .privacy-text p {
            color: var(--color-neutral-700);
            font-size: var(--font-size-body);
            margin: 0;
        }

        .related-tools {
            padding: var(--spacing-3xl) 0;
            background: var(--color-neutral-50);
        }

        .related-title {
            font-size: var(--font-size-subtitle);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-900);
            margin-bottom: var(--spacing-xl);
            text-align: center;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .related-card {
            background: var(--color-surface);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-card);
            padding: var(--spacing-lg);
            text-decoration: none;
            transition: all var(--duration-standard) var(--easing-standard);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .related-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-card-hover);
            border-color: var(--color-primary-100);
        }

        .related-icon {
            font-size: 2em;
            flex-shrink: 0;
        }

        .related-content h4 {
            font-size: var(--font-size-body-large);
            font-weight: var(--font-weight-semibold);
            color: var(--color-neutral-900);
            margin-bottom: var(--spacing-xs);
        }

        .related-content p {
            color: var(--color-neutral-700);
            font-size: var(--font-size-body);
            margin: 0;
        }

        @media (max-width: 768px) {
            .file-details {
                flex-direction: column;
                gap: var(--spacing-sm);
            }
            
            .preset-buttons {
                justify-content: center;
            }
            
            .audio-options {
                gap: var(--spacing-sm);
            }
            
            .preview-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .output-container {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
            }
            
            .output-actions {
                justify-content: center;
            }
            
            .privacy-content {
                flex-direction: column;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .preset-buttons {
                flex-direction: column;
            }
            
            .output-actions {
                flex-direction: column;
            }
        }
    </style>
</body>
</html>