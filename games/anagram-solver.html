<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anagram Solver</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        
        header {
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: rgba(30, 30, 46, 0.8);
            padding: 15px;
            border-radius: 10px;
        }
        
        .difficulty {
            margin-bottom: 20px;
        }
        
        .difficulty button {
            background: rgba(30, 30, 46, 0.8);
            margin: 0 5px;
        }
        
        .difficulty button.active {
            background: linear-gradient(to right, #8b5cf6, #ec4899);
        }
        
        .scrambled-word {
            font-size: 3rem;
            letter-spacing: 10px;
            margin: 30px 0;
            padding: 20px;
            background: rgba(30, 30, 46, 0.8);
            border-radius: 10px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .input-area {
            margin: 20px 0;
        }
        
        .input-area input {
            width: 100%;
            max-width: 400px;
            padding: 15px 20px;
            font-size: 1.5rem;
            border: none;
            border-radius: 10px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid #4b5563;
        }
        
        .input-area input:focus {
            outline: none;
            border-color: #8b5cf6;
        }
        
        .letters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .letter-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .letter-btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
        }
        
        .letter-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }
        
        .game-status {
            margin: 20px 0;
            font-size: 1.3rem;
            min-height: 30px;
        }
        
        .solutions {
            margin: 20px 0;
            text-align: left;
        }
        
        .solutions h3 {
            margin-bottom: 15px;
            color: #8b5cf6;
        }
        
        .solution-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .solution-word {
            background: rgba(139, 92, 246, 0.2);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #8b5cf6;
        }
        
        .solution-word.found {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
        }
        
        button {
            background: linear-gradient(to right, #8b5cf6, #ec4899);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .hint {
            color: #f59e0b;
            margin: 10px 0;
            min-height: 25px;
        }
        
        .score-display {
            font-size: 1.2rem;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Anagram Solver</h1>
        </header>
        
        <div class="game-info">
            <div>Difficulty: <span id="difficulty-level">Easy</span></div>
            <div>Score: <span id="score">0</span></div>
            <div>Time: <span id="timer">0</span>s</div>
        </div>
        
        <div class="difficulty">
            <button id="easy-btn" class="active">Easy</button>
            <button id="medium-btn">Medium</button>
            <button id="hard-btn">Hard</button>
        </div>
        
        <div class="scrambled-word" id="scrambled-word"></div>
        
        <div class="hint" id="hint"></div>
		
		<!-- Add this to your game container -->
		<div id="definition" class="definition" style="
			font-style: italic; 
			color: #666; 
			text-align: center; 
			margin: 10px 0; 
			font-size: 0.9em;
		"></div>
        
        <div class="input-area">
            <input type="text" id="word-input" placeholder="Type your answer here..." maxlength="15">
        </div>
        
        <div class="letters" id="letters-container">
            <!-- Letters will be generated here -->
        </div>
        
        <div class="game-status" id="game-status">Unscramble the word!</div>
        
        <div class="controls">
            <button id="check-btn">Check Answer</button>
            <button id="hint-btn">Get Hint</button>
            <button id="shuffle-btn">Shuffle Letters</button>
        </div>
        
        <div class="score-display">
            Found: <span id="found-count">0</span>/<span id="total-words">0</span> words
        </div>
        
        <div class="solutions">
            <h3>Possible Words:</h3>
            <div class="solution-list" id="solution-list">
                <!-- Solutions will be shown here -->
            </div>
        </div>
        
        <div class="controls">
            <button id="new-game">New Anagram</button>
            <button id="reveal-btn">Reveal All</button>
        </div>
    </div>

    <script>
		let currentAnagramWord = null;
		let currentAnagramDefinition = null;

		async function initializeAnagramGame() {
			// Wait for vocabulary to load
			await vocabLoader.waitForLoad();
			
			// Get a random word based on selected difficulty
			const difficulty = document.getElementById('difficulty').value;
			const wordData = vocabLoader.getRandomWord(difficulty);
			
			if (wordData) {
				currentAnagramWord = wordData.word.toUpperCase();
				currentAnagramDefinition = wordData.definition;
				startAnagramGame();
			} else {
				alert('Error loading vocabulary. Please refresh the page.');
			}
		}

		// Update the difficulty change handler
		document.getElementById('difficulty').addEventListener('change', function() {
			if (confirm('Change difficulty? This will start a new game.')) {
				initializeAnagramGame();
			}
		});

		// Update to show definition
		function displayAnagramDefinition() {
			const definitionElement = document.getElementById('definition');
			if (definitionElement && currentAnagramDefinition) {
				definitionElement.textContent = `Definition: ${currentAnagramDefinition}`;
			}
		}

        const scrambledWordElement = document.getElementById('scrambled-word');
        const wordInput = document.getElementById('word-input');
        const lettersContainer = document.getElementById('letters-container');
        const gameStatus = document.getElementById('game-status');
        const hintElement = document.getElementById('hint');
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');
        const foundCountElement = document.getElementById('found-count');
        const totalWordsElement = document.getElementById('total-words');
        const solutionList = document.getElementById('solution-list');
        const difficultyLevel = document.getElementById('difficulty-level');
        const checkBtn = document.getElementById('check-btn');
        const hintBtn = document.getElementById('hint-btn');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const newGameBtn = document.getElementById('new-game');
        const revealBtn = document.getElementById('reveal-btn');
        const difficultyBtns = document.querySelectorAll('.difficulty button');

        let currentWord = '';
        let scrambledLetters = [];
        let allSolutions = [];
        let foundSolutions = new Set();
        let score = 0;
        let timer = 0;
        let timerInterval = null;
        let gameActive = false;
        let currentDifficulty = 'easy';

        function initGame() {
            // Clear previous game
            clearInterval(timerInterval);
            timer = 0;
            timerElement.textContent = timer;
            foundSolutions.clear();
            wordInput.value = '';
            hintElement.textContent = '';
            
            // Get random word based on difficulty
            //const wordList = vocabulary[currentDifficulty];
            //currentWord = wordList[Math.floor(Math.random() * wordList.length)].toUpperCase();
            
			displayAnagramDefinition();
			
            // Generate all possible anagrams
            allSolutions = generateAnagrams(currentWord);
            totalWordsElement.textContent = allSolutions.length;
            foundCountElement.textContent = foundSolutions.size;
            
            // Scramble the letters
            scrambledLetters = scrambleWord(currentWord);
            updateScrambledWord();
            
            // Create letter buttons
            createLetterButtons();
            
            // Update solutions display
            updateSolutionsDisplay();
            
            // Start timer
            gameActive = true;
            timerInterval = setInterval(() => {
                if (gameActive) {
                    timer++;
                    timerElement.textContent = timer;
                }
            }, 1000);
            
            gameStatus.textContent = 'Unscramble the word!';
            gameStatus.style.color = '#fff';
        }

        function scrambleWord(word) {
            const letters = word.split('');
            for (let i = letters.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [letters[i], letters[j]] = [letters[j], letters[i]];
            }
            return letters;
        }

        function generateAnagrams(word) {
            const words = new Set();
            
            // For simplicity, we'll use a subset of possible anagrams
            // In a real implementation, you'd check against a dictionary
            
            // Generate permutations (limited for performance)
            function permute(arr, start = 0) {
                if (start >= arr.length - 1) {
                    const candidate = arr.join('');
                    // Only add words of reasonable length
                    if (candidate.length >= 3 && candidate.length <= word.length) {
                        words.add(candidate);
                    }
                    return;
                }
                
                for (let i = start; i < arr.length; i++) {
                    [arr[start], arr[i]] = [arr[i], arr[start]];
                    permute([...arr], start + 1);
                    [arr[start], arr[i]] = [arr[i], arr[start]];
                }
            }
            
            // Generate shorter words too
            for (let length = 3; length <= word.length; length++) {
                // Simple combination generation (this is simplified)
                // In a real game, you'd use a proper word list
                const letters = word.split('');
                for (let i = 0; i < 50; i++) { // Limit attempts for performance
                    const shuffled = [...letters].sort(() => 0.5 - Math.random());
                    const candidate = shuffled.slice(0, length).join('');
                    if (candidate.length >= 3) {
                        words.add(candidate);
                    }
                }
            }
            
            // Filter to only include words from our vocabulary
            const allWords = [...vocabulary.easy, ...vocabulary.medium, ...vocabulary.hard]
                .map(w => w.toUpperCase());
            
            return Array.from(words).filter(word => 
                allWords.includes(word) && word.length >= 3
            ).slice(0, 10); // Limit to 10 solutions for gameplay
        }

        function updateScrambledWord() {
            scrambledWordElement.textContent = scrambledLetters.join(' ');
        }

        function createLetterButtons() {
            lettersContainer.innerHTML = '';
            
            scrambledLetters.forEach((letter, index) => {
                const button = document.createElement('button');
                button.className = 'letter-btn';
                button.textContent = letter;
                button.dataset.index = index;
                
                button.addEventListener('click', () => {
                    if (gameActive) {
                        wordInput.value += letter;
                        button.disabled = true;
                    }
                });
                
                lettersContainer.appendChild(button);
            });
        }

        function checkAnswer() {
            if (!gameActive) return;
            
            const answer = wordInput.value.toUpperCase().trim();
            
            if (answer.length < 3) {
                gameStatus.textContent = 'Word must be at least 3 letters!';
                gameStatus.style.color = '#f59e0b';
                return;
            }
            
            if (foundSolutions.has(answer)) {
                gameStatus.textContent = 'You already found this word!';
                gameStatus.style.color = '#f59e0b';
                return;
            }
            
            if (allSolutions.includes(answer)) {
                // Correct answer
                foundSolutions.add(answer);
                score += calculateScore(answer);
                scoreElement.textContent = score;
                foundCountElement.textContent = foundSolutions.size;
                
                gameStatus.textContent = `Correct! +${calculateScore(answer)} points`;
                gameStatus.style.color = '#10b981';
                
                // Update solutions display
                updateSolutionsDisplay();
                
                // Check if all solutions found
                if (foundSolutions.size === allSolutions.length) {
                    gameActive = false;
                    clearInterval(timerInterval);
                    gameStatus.textContent = `Congratulations! You found all ${allSolutions.length} words!`;
                    gameStatus.style.color = '#10b981';
                }
                
                // Reset input and enable all letters
                wordInput.value = '';
                enableAllLetters();
                
            } else {
                // Incorrect answer
                gameStatus.textContent = 'Not a valid word!';
                gameStatus.style.color = '#ef4444';
            }
        }

        function calculateScore(word) {
            const baseScore = word.length * 10;
            const timeBonus = Math.max(0, 300 - timer); // Bonus for speed
            return baseScore + Math.floor(timeBonus / 10);
        }

        function provideHint() {
            if (!gameActive) return;
            
            const unfoundSolutions = allSolutions.filter(word => !foundSolutions.has(word));
            if (unfoundSolutions.length > 0) {
                const hintWord = unfoundSolutions[Math.floor(Math.random() * unfoundSolutions.length)];
                const hintLength = Math.floor(hintWord.length / 2);
                const hint = hintWord.substring(0, hintLength) + '_'.repeat(hintWord.length - hintLength);
                
                hintElement.textContent = `Hint: ${hint}`;
                
                // Small score penalty for using hint
                score = Math.max(0, score - 20);
                scoreElement.textContent = score;
            }
        }

        function shuffleLetters() {
            if (!gameActive) return;
            
            scrambledLetters = scrambleWord(currentWord);
            updateScrambledWord();
            
            // Recreate letter buttons
            createLetterButtons();
            
            // Small score penalty for shuffling
            score = Math.max(0, score - 5);
            scoreElement.textContent = score;
        }

        function enableAllLetters() {
            document.querySelectorAll('.letter-btn').forEach(btn => {
                btn.disabled = false;
            });
        }

        function updateSolutionsDisplay() {
            solutionList.innerHTML = '';
            
            allSolutions.forEach(word => {
                const solutionElement = document.createElement('div');
                solutionElement.className = `solution-word ${foundSolutions.has(word) ? 'found' : ''}`;
                solutionElement.textContent = word;
                solutionList.appendChild(solutionElement);
            });
        }

        function revealAllSolutions() {
            allSolutions.forEach(word => {
                if (!foundSolutions.has(word)) {
                    foundSolutions.add(word);
                    score += Math.floor(calculateScore(word) * 0.5); // Half points for reveal
                }
            });
            
            scoreElement.textContent = score;
            foundCountElement.textContent = foundSolutions.size;
            updateSolutionsDisplay();
            
            gameActive = false;
            clearInterval(timerInterval);
            gameStatus.textContent = 'All words revealed!';
            gameStatus.style.color = '#8b5cf6';
        }

        function setDifficulty(level) {
            currentDifficulty = level;
            difficultyLevel.textContent = level.charAt(0).toUpperCase() + level.slice(1);
            difficultyBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            initGame();
        }

        // Event listeners
        checkBtn.addEventListener('click', checkAnswer);
        hintBtn.addEventListener('click', provideHint);
        shuffleBtn.addEventListener('click', shuffleLetters);
        newGameBtn.addEventListener('click', initGame);
        revealBtn.addEventListener('click', revealAllSolutions);

        wordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        wordInput.addEventListener('input', () => {
            // Re-enable letters when user types
            enableAllLetters();
        });

        difficultyBtns.forEach(btn => {
            btn.addEventListener('click', (e) => setDifficulty(e.target.id.replace('-btn', '')));
        });

        // Initialize first game
        initGame();
    </script>
</body>
</html>